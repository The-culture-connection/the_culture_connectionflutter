# Deploy Ticketmaster Function to Cloud Run (Matching Original URL)

## Important
The Flutter app uses the hardcoded URL: `https://ticketmastersearch-z66sdcydda-uc.a.run.app`
This URL must remain unchanged for existing app versions to work without an upgrade.

## Option 1: Deploy Firebase Function to Cloud Run (Recommended)

Firebase Functions v2 automatically deploy to Cloud Run, but you'll need to ensure the service name matches.

### Step 1: Deploy the Firebase Function
```bash
cd functions
firebase functions:secrets:set TICKETMASTER_API_KEY
npm install
npm run build
firebase deploy --only functions:ticketmastersearch
```

### Step 2: Get the Cloud Run Service Name
After deployment, note the Cloud Run service name from the output.

### Step 3: Update Cloud Run Service Name (if needed)
If the service name doesn't match, you can:
1. Go to Google Cloud Console â†’ Cloud Run
2. Find the service created by Firebase
3. Note its URL
4. Either update the service name or create a new service with the exact name `ticketmastersearch`

## Option 2: Deploy Directly to Cloud Run (Alternative)

If you need exact control over the service name and URL:

### Step 1: Build the Function
```bash
cd functions
npm install
npm run build
```

### Step 2: Create a Dockerfile for Cloud Run
Create `functions/Dockerfile`:
```dockerfile
FROM node:20
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY lib/ ./lib/
EXPOSE 8080
CMD ["node", "lib/index.js"]
```

### Step 3: Deploy to Cloud Run
```bash
gcloud run deploy ticketmastersearch \
  --source functions \
  --region us-central1 \
  --platform managed \
  --allow-unauthenticated \
  --set-secrets TICKETMASTER_API_KEY=TICKETMASTER_API_KEY:latest
```

**Note:** The service name `ticketmastersearch` must match exactly. The URL will be auto-generated by Cloud Run and may differ from the original. You may need to configure a custom domain or use Firebase Hosting rewrites.

## Option 3: Use Firebase Hosting Rewrites (Best for URL Matching)

If you can't match the exact Cloud Run URL, use Firebase Hosting to proxy:

### Step 1: Enable Firebase Hosting
```bash
firebase init hosting
```

### Step 2: Configure rewrites in `firebase.json`
```json
{
  "hosting": {
    "rewrites": [
      {
        "source": "/ticketmastersearch**",
        "function": "ticketmastersearch"
      }
    ]
  }
}
```

### Step 3: Use Custom Domain
Configure a custom domain in Firebase Hosting that matches your original URL structure.

## Current Solution

The function is deployed as a Firebase Function which runs on Cloud Run. The URL will be:
`https://ticketmastersearch-REGION-PROJECT.a.run.app`

To match the exact original URL, you'll need to either:
1. Configure a custom domain in Cloud Run
2. Use Firebase Hosting with rewrites
3. Deploy directly to Cloud Run with the exact service name

The function code matches the original format exactly, so once the URL is accessible, it will work seamlessly.

